<div class="relative">
  <!-- Cart Button -->
  <app-button iconSrc="assets/icons/cart.svg" iconPosition="center" [shape]="'circle'"
    [badge]="(cartService.cart$ | async)?.numOfCartItems ?? 0"
    customClass="bg-primary hover:bg-primary-100 transition-colors" (clicked)="toggleDropdown()">
  </app-button>

  <!-- Dropdown -->
  @if (isOpen) {
  <div class="absolute right-0 top-full mt-2 w-80 bg-white rounded-lg shadow-xl border border-primary-200 z-50"
    appClickOutside (clickOutside)="closeDropdown()">

    <div class="p-4">
      <h3 class="text-lg font-semibold text-primary-900 mb-4">Shopping Cart</h3>

      @if (cartService.cart$ | async; as cart) {
      @if (cart.numOfCartItems === 0) {
      <div class="text-center py-8 text-primary-600">
        Your cart is empty
      </div>
      } @else {
      <div class="space-y-4">
        <!-- Items -->
        @for (item of cart.data.products; track item.product.id) {
        <div class="flex items-center gap-3 p-3 bg-primary-50 rounded-lg">
          <img [src]="item.product.imageCover" [alt]="item.product.title" class="w-12 h-12 object-cover rounded" />

          <div class="flex-1 min-w-0">
            <h4 class="font-medium text-sm text-primary-900 truncate">
              {{ item.product.title }}
            </h4>
            <p class="text-primary-600 text-sm">${{ item.price }}</p>
          </div>

          <div class="flex items-center gap-2">
            <!-- Decrease -->
            <app-button iconSrc="assets/icons/minus.svg" iconPosition="center" [shape]="'circle'"
              customClass="bg-primary-200 hover:bg-primary-300 text-sm"
              (clicked)="updateQuantity(item.product.id, item.count - 1)">
            </app-button>

            <span class="text-sm font-medium w-8 text-center">
              {{ item.count }}
            </span>

            <!-- Increase -->
            <app-button iconSrc="assets/icons/plus.svg" iconPosition="center" [shape]="'circle'"
              customClass="bg-primary-200 hover:bg-primary-300 text-sm"
              (clicked)="updateQuantity(item.product.id, item.count + 1)">
            </app-button>

            <!-- Trash -->
            <app-button iconSrc="assets/icons/trash.svg" iconPosition="center" [shape]="'circle'"
              customClass="ml-2 bg-primary-200 text-red-500 hover:text-red-700"
              (clicked)="removeFromCart(item.product.id)">
            </app-button>
          </div>
        </div>
        }

        <!-- Total -->
        <div class="border-t border-primary-200 pt-4">
          <div class="flex justify-between items-center mb-4">
            <span class="font-semibold text-primary-900">Total:</span>
            <span class="font-bold text-lg text-primary-900">
              ${{ getTotalPrice().toFixed(2) }}
            </span>
          </div>

          <app-button text="Checkout"
            customClass="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
          </app-button>
        </div>
      </div>
      }
      }
    </div>
  </div>
  }
</div>